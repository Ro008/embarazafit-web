---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Birth Plan | Embarazafit">
  <section class="birth-plan-container" id="birth-plan-container">
    <h2 class="pdf-title">My Birth Plan</h2>
    <div class="language-selector">
      <a href="/plan-de-parto" class="lang-btn">Español</a>
      <a href="/birth-plan" class="lang-btn active">English</a>
    </div>

    <div class="instructions">
      <p>
        He creado este plan de parto inspirada en las recomendaciones de mi
        matrona, una maravillosa profesional defensora del parto respetado,
        donde nosotras seamos las protagonistas.
        <br /><br />
        <strong>Recuerda:</strong> Este es un documento guía. Te animo a que lo
        comentes con tu equipo médico. Si te queda alguna duda o tienes alguna
        sugerencia de mejora, puedes dejarme un comentario en
        <a
          href="https://www.instagram.com/reel/DNGKE9jtsKD/?utm_source=ig_web_copy_link&igsh=MzRlODBiNWFlZA=="
          target="_blank"
          rel="noopener noreferrer"
          >este vídeo</a
        >.
      </p>

      <p>
        Este es un plan de parto interactivo. Simplemente haz clic en
        <i>"Añadir al plan"</i> en cada opción que te interese, y se irá
        añadiendo a tu lista de preferencias. Cuando hayas terminado, haz clic
        en <i>"Generar PDF"</i>
        para obtener tu documento final personalizado.
      </p>
    </div>

    <p class="intro-text">
      We have completed this birth plan in accordance with our wishes for the
      birth of our child, after attending prenatal childbirth preparation
      sessions and having been informed of our options. Our choices were made
      jointly, thoughtfully, and based on guidelines from recognized
      organizations promoting natural childbirth and breastfeeding. We would
      like to collaborate with you to ensure a calm and safe birth experience
      that supports the physical and emotional health of our child. We are happy
      to discuss any questions or concerns you may have.
    </p>

    <div id="personal-info-section" class="plan-section">
      <h3>Personal Information</h3>
      <div class="input-group">
        <label for="mother-name">Mother's Name:</label>
        <input type="text" id="mother-name" name="mother-name" />
      </div>
      <div class="input-group">
        <label for="name-pronunciation">Name Pronunciation:</label>
        <input
          type="text"
          id="name-pronunciation"
          name="name-pronunciation"
          placeholder="e.g. ro-SEE-oh"
        />
      </div>
      <div class="input-group">
        <label for="companion-name">Companion's Name:</label>
        <input type="text" id="companion-name" name="companion-name" />
      </div>
      <div class="input-group">
        <label for="hospital">Hospital:</label>
        <input type="text" id="hospital" name="hospital" />
      </div>
      <div class="input-group">
        <label for="gynecologist">Gynecologist:</label>
        <input type="text" id="gynecologist" name="gynecologist" />
      </div>
      <div class="input-group">
        <label for="pediatrician">Pediatrician:</label>
        <input type="text" id="pediatrician" name="pediatrician" />
      </div>
    </div>

    <div class="user-plan-container">
      <h3 class="draft-title">Mi Borrador de Plan de Parto</h3>
      <ul id="user-plan-list"></ul>
      <button id="generate-pdf-btn">Generar PDF</button>
    </div>

    <div
      id="delivery-type-section"
      class="plan-section"
      data-section-title="Type of Delivery"
    >
      <h3>Type of Delivery</h3>
      <div class="option-list">
        <div
          class="option-item"
          data-option-text="Natural birth without medical interventions"
        >
          <span>Natural birth without medical interventions</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div class="option-item" data-option-text="Normal vaginal birth">
          <span>Normal vaginal birth</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div class="option-item" data-option-text="Cesarean with epidural">
          <span>Cesarean with epidural</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="Cesarean with general anesthesia"
        >
          <span>Cesarean with general anesthesia</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="VBAC (Vaginal Birth After Cesarean)"
        >
          <span>VBAC (Vaginal Birth After Cesarean)</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
      </div>
    </div>

    <div
      id="people-present-section"
      class="plan-section"
      data-section-title="People Present During Delivery"
    >
      <h3>People Present During Delivery</h3>
      <div class="option-list">
        <div class="option-item" data-option-text="Partner/Spouse">
          <span>Partner/Spouse</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div class="option-item" data-option-text="Family Member">
          <span>Family Member</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div class="option-item" data-option-text="Other">
          <span>Other</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
      </div>
    </div>

    <div
      id="preparation-section"
      class="plan-section"
      data-section-title="Preparation for Delivery"
    >
      <h3>Preparation for Delivery</h3>
      <div class="option-list">
        <div
          class="option-item"
          data-option-text="I do not wish for shaving of the genital area"
        >
          <span>I do not wish for shaving of the genital area</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div class="option-item" data-option-text="I do not want an enema">
          <span>I do not want an enema</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="I prefer not to have an IV drip if movement is possible"
        >
          <span
            >I prefer not to have an IV drip if movement is possible, though a
            saline-locked IV is acceptable if necessary</span
          >
          <button class="add-btn">Añadir al plan</button>
        </div>
      </div>
    </div>

    <div
      id="monitoring-section"
      class="plan-section"
      data-section-title="Fetal Monitoring"
    >
      <h3>Fetal Monitoring</h3>
      <div class="option-list">
        <div
          class="option-item"
          data-option-text="I prefer intermittent cardiotocography"
        >
          <span>I prefer intermittent cardiotocography</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="I prefer continuous cardiotocography"
        >
          <span>I prefer continuous cardiotocography</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
      </div>
    </div>

    <div
      id="environment-section"
      class="plan-section"
      data-section-title="Environment and Personal Preferences"
    >
      <h3>Environment and Personal Preferences</h3>
      <div class="option-list">
        <div
          class="option-item"
          data-option-text="Request all staff to introduce themselves and their role before any procedure"
        >
          <span
            >Request all staff to introduce themselves and their role before any
            procedure</span
          >
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="I would like a warm and calm atmosphere in the delivery room"
        >
          <span
            >I would like a warm and calm atmosphere in the delivery room</span
          >
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="Minimize clinic staff presence"
        >
          <span>Minimize clinic staff presence</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div class="option-item" data-option-text="Low lighting">
          <span>Low lighting</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div class="option-item" data-option-text="Personal music">
          <span>Personal music</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div class="option-item" data-option-text="Wear my own clothing">
          <span>Wear my own clothing</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div class="option-item" data-option-text="Birth ball/pillows">
          <span>Birth ball/pillows</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="Option to photograph/film freely"
        >
          <span>Option to photograph/film freely</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="Bath or shower, if available"
        >
          <span>Bath or shower, if available</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
      </div>
    </div>

    <div
      id="pain-relief-section"
      class="plan-section"
      data-section-title="Pain Relief During Labor"
    >
      <h3>Pain Relief During Labor</h3>
      <div class="option-list">
        <div
          class="option-item"
          data-option-text="Natural pain relief methods (movement, body position, massage, breathing, heat packs, etc.)"
        >
          <span
            >Natural pain relief methods (movement, body position, massage,
            breathing, heat packs, etc.)</span
          >
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="Support from midwife/partner"
        >
          <span>Support from midwife/partner</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="Freedom for spontaneous expression (vocalizing, movement)"
        >
          <span>Freedom for spontaneous expression (vocalizing, movement)</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div class="option-item" data-option-text="Walking epidural">
          <span>Walking epidural</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="Epidural only if I request it and after being informed of possible effects on baby and labor"
        >
          <span
            >Epidural only if I request it and after being informed of possible
            effects on baby and labor</span
          >
          <button class="add-btn">Añadir al plan</button>
        </div>
      </div>
    </div>

    <div
      id="labor-onset-section"
      class="plan-section"
      data-section-title="Labor Onset and Progression"
    >
      <h3>Labor Onset and Progression</h3>
      <div class="option-list">
        <div
          class="option-item"
          data-option-text="I prefer spontaneous labor onset and am willing to wait"
        >
          <span>I prefer spontaneous labor onset and am willing to wait</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="If induction or augmentation is necessary, I wish to be informed of the exact reasons"
        >
          <span
            >If induction or augmentation is necessary, I wish to be informed of
            the exact reasons and that it only proceed, if medically
            necessary</span
          >
          <button class="add-btn">Añadir al plan</button>
        </div>
      </div>
    </div>
    <div
      id="interventions-section"
      class="plan-section"
      data-section-title="Medical Interventions and Monitoring"
    >
      <h3>Medical Interventions and Monitoring</h3>
      <div class="option-list">
        <div
          class="option-item"
          data-option-text="Limit vaginal exams to every 4 hours and require explicit consent"
        >
          <span
            >Limit vaginal exams to every 4 hours and require explicit
            consent</span
          >
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="Prefer to avoid vacuum or forceps unless medically critical"
        >
          <span
            >Prefer to avoid vacuum or forceps unless medically critical</span
          >
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="I do not consent to the Kristeller maneuver"
        >
          <span
            >I do not consent to the Kristeller maneuver (fundal pressure)</span
          >
          <button class="add-btn">Añadir al plan</button>
        </div>
      </div>
    </div>
    <div
      id="active-labor-section"
      class="plan-section"
      data-section-title="Active Labor and Pushing"
    >
      <h3>Active Labor and Pushing</h3>
      <div class="option-list">
        <div
          class="option-item"
          data-option-text="Minimize staff presence to essential personnel only"
        >
          <span
            >Minimize staff presence to essential personnel only (partner,
            midwife, doctor, pediatrician)</span
          >
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="I wish to start pushing when I feel the need"
        >
          <span>I wish to start pushing when I feel the need</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="I would like guidance on when to push"
        >
          <span>I would like guidance on when to push</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="I prefer to choose the most comfortable pushing position"
        >
          <span>I prefer to choose the most comfortable pushing position</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="I prefer to avoid an episiotomy unless absolutely necessary"
        >
          <span
            >I prefer to avoid an episiotomy unless absolutely necessary</span
          >
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="To prevent perineal trauma, I prefer gentle pushing with oil massage, supported perineum, and positional adjustments"
        >
          <span
            >To prevent perineal trauma, I prefer gentle pushing with oil
            massage, supported perineum, and positional adjustments</span
          >
          <button class="add-btn">Añadir al plan</button>
        </div>
      </div>
    </div>

    <div
      id="after-birth-section"
      class="plan-section"
      data-section-title="Immediately After Birth"
    >
      <h3>Immediately After Birth</h3>
      <div class="option-list">
        <div
          class="option-item"
          data-option-text="Place my baby on my chest, skin-to-skin"
        >
          <span>Place my baby on my chest, skin-to-skin</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="Delayed cord clamping (at least 3-5 minutes)"
        >
          <span>Delayed cord clamping (at least 3-5 minutes)</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="My partner will cut the cord"
        >
          <span>My partner will cut the cord</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="Hold baby during placental delivery and any perineal sutures"
        >
          <span
            >Hold baby during placental delivery and any perineal sutures</span
          >
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="First breastfeeding within the first hour"
        >
          <span>First breastfeeding within the first hour</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="Collection of stem cells from the umbilical cord"
        >
          <span
            >Collection of stem cells from the umbilical cord (I have the
            collection kit)</span
          >
          <button class="add-btn">Añadir al plan</button>
        </div>
      </div>
    </div>

    <div
      id="cesarean-section"
      class="plan-section"
      data-section-title="In Case of Cesarean Delivery"
    >
      <h3>In Case of Cesarean Delivery</h3>
      <div class="option-list">
        <div
          class="option-item"
          data-option-text="I would like to avoid cesarean unless absolutely necessary"
        >
          <span
            >I would like to avoid cesarean unless absolutely necessary</span
          >
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="Prefer epidural over general anesthesia"
        >
          <span>Prefer epidural over general anesthesia</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="I wish to be informed throughout the procedure if I am conscious"
        >
          <span
            >I wish to be informed throughout the procedure if I am
            conscious</span
          >
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="Keep my hands free to hold my baby"
        >
          <span>Keep my hands free to hold my baby</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="Skin-to-skin contact and breastfeeding in the operating room"
        >
          <span
            >Skin-to-skin contact and breastfeeding in the operating room</span
          >
          <button class="add-btn">Añadir al plan</button>
        </div>
      </div>
    </div>

    <div
      id="newborn-care-section"
      class="plan-section"
      data-section-title="Newborn Care"
    >
      <h3>Newborn Care</h3>
      <div class="option-list">
        <div
          class="option-item"
          data-option-text="Gently wipe the baby and place on my chest"
        >
          <span>Gently wipe the baby and place on my chest</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="Delay baby's bath for at least 24 hours"
        >
          <span>Delay baby's bath for at least 24 hours</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="We will perform the first bath at home"
        >
          <span>We will perform the first bath at home</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="Do not give vitamin K injection"
        >
          <span>Do not give vitamin K injection</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div class="option-item" data-option-text="No pacifiers or bottles">
          <span>No pacifiers or bottles</span>
          <button class="add-btn">Añadir al plan</button>
        </div>
      </div>
    </div>

    <div
      id="feeding-plan-section"
      class="plan-section"
      data-section-title="Feeding Plan"
    >
      <h3>Feeding Plan</h3>
      <div class="option-list">
        <div
          class="option-item"
          data-option-text="I plan to exclusively breastfeed, so do not provide formula, tea, etc"
        >
          <span
            >I plan to exclusively breastfeed, so do not provide formula, tea,
            etc</span
          >
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="If supplementation is needed, I prefer to use my expressed milk"
        >
          <span
            >If supplementation is needed, I prefer to use my expressed
            milk</span
          >
          <button class="add-btn">Añadir al plan</button>
        </div>
        <div
          class="option-item"
          data-option-text="If formula is necessary, please consult me and explain the reasons"
        >
          <span
            >If formula is necessary, please consult me and explain the
            reasons</span
          >
          <button class="add-btn">Añadir al plan</button>
        </div>
      </div>
    </div>

    <div id="other-section" class="plan-section">
      <h3>Other Preferences</h3>
      <div class="input-group">
        <label for="other-preferences"
          >Añade aquí cualquier otra preferencia que no hayas encontrado en las
          opciones anteriores.</label
        >
        <textarea
          id="other-preferences"
          name="other-preferences"
          rows="5"
        ></textarea>
      </div>
    </div>
  </section>
  <div id="toast" class="toast"></div>
</Layout>
<style>
  .birth-plan-container {
    padding: 30px;
    max-width: 900px;
    margin: 0 auto;
    font-family: "Poppins", sans-serif;
    color: var(--dark-charcoal);
  }

  .instructions {
    background-color: var(--dusty-rose);
    border-left: 5px solid var(--deep-teal);
    padding: 15px;
    margin-bottom: 20px;
    border-radius: 5px;
  }

  .intro-text {
    line-height: 1.6;
    margin-bottom: 40px;
    font-style: italic;
  }

  .plan-section {
    background-color: var(--pale-sand);
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  }

  .plan-section h3 {
    border-bottom: 2px solid var(--deep-teal);
    padding-bottom: 10px;
    margin-bottom: 15px;
    color: var(--dark-charcoal);
  }

  .input-group {
    margin-bottom: 15px;
  }

  .input-group label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
  }

  .input-group input[type="text"],
  .input-group textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid var(--dusty-rose);
    border-radius: 5px;
    box-sizing: border-box;
    font-family: "Poppins", sans-serif;
  }

  .option-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .option-item {
    position: relative;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #ffffff;
    padding: 10px 15px;
    border-radius: 5px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  }

  .add-btn {
    background-color: var(--vibrant-coral);
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.3s ease;
  }

  .add-btn:hover {
    background-color: var(--rusty-red);
  }

  .add-btn[disabled] {
    background-color: var(--dusty-rose);
    color: #fff;
    cursor: not-allowed;
    pointer-events: auto;
  }

  .user-plan-container {
    margin-top: 40px;
    padding: 20px;
    background-color: #f7f7f7;
    border-radius: 8px;
  }

  #user-plan-list {
    list-style-type: none;
    padding: 0;
  }

  .plan-item {
    background-color: white;
    padding: 10px 15px;
    border-radius: 5px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  }

  .remove-btn {
    background: none;
    border: none;
    color: var(--rusty-red);
    cursor: pointer;
    font-size: 1.2em;
  }

  #generate-pdf-btn {
    display: block;
    width: 100%;
    padding: 15px;
    margin-top: 20px;
    background-color: var(--deep-teal);
    color: white;
    border: none;
    border-radius: 5px;
    font-size: 1.1em;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  #generate-pdf-btn:hover {
    background-color: var(--gunmetal);
  }

  .toast {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: var(--deep-teal);
    color: #fff;
    padding: 10px 20px;
    border-radius: 5px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    opacity: 0;
    visibility: hidden;
    transition:
      opacity 0.5s ease-in-out,
      visibility 0.5s ease-in-out;
    z-index: 1000;
    font-family: "Poppins", sans-serif;
  }

  .toast.show {
    opacity: 1;
    visibility: visible;
  }

  .language-selector {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
  }
  .lang-btn {
    padding: 8px 16px;
    border: 2px solid transparent;
    background-color: #f0f0f0;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    text-decoration: none;
    color: var(--dark-charcoal);
  }
  .lang-btn.active {
    background-color: var(--deep-teal);
    color: white;
  }
  .lang-btn:not(.active):hover {
    background-color: var(--dusty-rose);
  }
</style>
<script>
  import jsPDF from "jspdf";

  function showToast(message) {
    const toast = document.getElementById("toast");
    if (toast) {
      toast.textContent = message;
      toast.classList.add("show");
      setTimeout(() => {
        toast.classList.remove("show");
      }, 3000);
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    const addButtons = document.querySelectorAll(".add-btn");
    const userPlanList = document.getElementById("user-plan-list");
    const generatePdfBtn = document.getElementById("generate-pdf-btn");

    addButtons.forEach((button) => {
      button.addEventListener("click", () => {
        const optionItem = button.closest(".option-item");
        const optionText = optionItem.getAttribute("data-option-text");
        const sectionTitle = optionItem
          .closest(".plan-section")
          .getAttribute("data-section-title");

        const isAlreadyAdded =
          userPlanList.querySelector(`[data-option-text="${optionText}"]`) !==
          null;

        if (!isAlreadyAdded) {
          const listItem = document.createElement("li");
          listItem.className = "plan-item";
          listItem.setAttribute("data-option-text", optionText);
          listItem.setAttribute("data-section-title", sectionTitle);
          listItem.innerHTML = `
            <span>${optionItem.querySelector("span").textContent}</span>
            <button class="remove-btn">
              <i class="fas fa-times"></i>
            </button>
          `;
          userPlanList.appendChild(listItem);

          button.textContent = "Añadida";
          button.disabled = true;
          button.title = "Preferencia ya añadida a tu lista";
          showToast("¡Preferencia añadida!");

          listItem
            .querySelector(".remove-btn")
            .addEventListener("click", () => {
              listItem.remove();
              button.textContent = "Añadir al plan";
              button.disabled = false;
              button.removeAttribute("title");
            });
        }
      });
    });

    if (generatePdfBtn) {
      generatePdfBtn.addEventListener("click", () => {
        generatePdfBtn.disabled = true;
        generatePdfBtn.textContent = "Generando PDF...";

        const personalInfo = {};
        const personalInfoSection = document.getElementById(
          "personal-info-section"
        );
        personalInfoSection
          .querySelectorAll(".input-group")
          .forEach((group) => {
            const label = group
              .querySelector("label")
              .textContent.replace(":", "")
              .trim();
            const value = group.querySelector("input").value;
            if (value) {
              personalInfo[label] = value;
            }
          });

        const otherPreferencesTextarea =
          document.getElementById("other-preferences");
        let otherPreferences = "";
        if (
          otherPreferencesTextarea &&
          otherPreferencesTextarea.value.trim() !== ""
        ) {
          otherPreferences = otherPreferencesTextarea.value.trim();
        }

        const sectionsData = {};
        document
          .querySelectorAll("#user-plan-list .plan-item")
          .forEach((item) => {
            const sectionTitle = item.getAttribute("data-section-title");
            const optionText = item.getAttribute("data-option-text");
            if (!sectionsData[sectionTitle]) {
              sectionsData[sectionTitle] = [];
            }
            sectionsData[sectionTitle].push(optionText);
          });

        const doc = new jsPDF("p", "mm", "a4");
        let y = 15;
        const margin = 15;
        const maxWidth = doc.internal.pageSize.getWidth() - 2 * margin;

        doc.setFontSize(22);
        doc.text("My Birth Plan", margin, y);
        y += 10;

        doc.setFontSize(12);
        const introText =
          "We have completed this birth plan in accordance with our wishes for the birth of our child, after attending prenatal childbirth preparation sessions and having been informed of our options. Our choices were made jointly, thoughtfully, and based on guidelines from recognized organizations promoting natural childbirth and breastfeeding. We would like to collaborate with you to ensure a calm and safe birth experience that supports the physical and emotional health of our child. We are happy to discuss any questions or concerns you may have.";
        const introTextLines = doc.splitTextToSize(introText, maxWidth);
        doc.text(introTextLines, margin, y);
        y += introTextLines.length * 5;
        y += 10;

        doc.setFontSize(16);
        doc.text("Personal Information", margin, y);
        doc.line(margin, y + 2, maxWidth + margin, y + 2);
        y += 7;

        for (const label in personalInfo) {
          doc.setFontSize(12);
          const text = `${label}: ${personalInfo[label]}`;
          const textLines = doc.splitTextToSize(text, maxWidth);
          doc.text(textLines, margin, y);
          y += textLines.length * 5 + 3;
        }
        y += 5;

        for (const title in sectionsData) {
          if (sectionsData.hasOwnProperty(title)) {
            if (y + 20 > doc.internal.pageSize.height - margin) {
              doc.addPage();
              y = 15;
            }

            doc.setFontSize(16);
            doc.text(title, margin, y);
            doc.line(margin, y + 2, maxWidth + margin, y + 2);
            y += 7;

            sectionsData[title].forEach((text) => {
              if (y + 10 > doc.internal.pageSize.height - margin) {
                doc.addPage();
                y = 15;
              }
              doc.setFontSize(12);
              const splitText = doc.splitTextToSize(`• ${text}`, maxWidth);
              doc.text(splitText, margin, y);
              y += splitText.length * 5 + 3;
            });
            y += 5;
          }
        }

        if (otherPreferences !== "") {
          if (y + 20 > doc.internal.pageSize.height - margin) {
            doc.addPage();
            y = 15;
          }
          doc.setFontSize(16);
          doc.text("Other Preferences", margin, y);
          doc.line(margin, y + 2, maxWidth + margin, y + 2);
          y += 7;

          doc.setFontSize(12);
          const otherTextLines = doc.splitTextToSize(
            otherPreferences,
            maxWidth
          );
          doc.text(otherTextLines, margin, y);
          y += otherTextLines.length * 5 + 3;
          y += 5;
        }

        doc.save("my-birth-plan.pdf");

        generatePdfBtn.disabled = false;
        generatePdfBtn.textContent = "Generar PDF";
      });
    }
  });
</script>
